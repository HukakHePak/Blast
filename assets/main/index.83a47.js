window.__require=function t(e,o,n){function i(c,s){if(!o[c]){if(!e[c]){var l=c.split("/");if(l=l[l.length-1],!e[l]){var a="function"==typeof __require&&__require;if(!s&&a)return a(l,!0);if(r)return r(l,!0);throw new Error("Cannot find module '"+c+"'")}c=l}var p=o[c]={exports:{}};e[c][0].call(p.exports,function(t){return i(e[c][1][t]||t)},p,p.exports,t,e,o,n)}return o[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<n.length;c++)i(n[c]);return i}({Animates:[function(t,e,o){"use strict";cc._RF.push(e,"ddf04v2a1ZHR7ahmehHWkAX","Animates"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function t(){}return t.slide=function(){},t.spawn=function(){},t.play=function(t,e){var o,n,i,r,c=t,s=null==e?void 0:e.target;s&&(c=cc.instantiate(t),s.addChild(c)),c.active=!0,c.zIndex+=10,c.x=null!==(o=null==e?void 0:e.x)&&void 0!==o?o:c.x,c.y=null!==(n=null==e?void 0:e.y)&&void 0!==n?n:c.y,c.angle=null!==(i=null==e?void 0:e.angle)&&void 0!==i?i:c.angle,c.scaleX=null!==(r=null==e?void 0:e.scaleX)&&void 0!==r?r:c.scaleX;var l=c.getComponent(cc.Animation),a=c.getComponent(cc.AudioSource);null==l||l.play(),null==a||a.play(),null==l||l.on(cc.Animation.EventType.FINISHED,function(){s&&s.removeChild(c),c.zIndex=0})},t.prototype.despawn=function(){},t.select=function(){},t.move=function(){},t}();o.default=n,cc._RF.pop()},{}],BombBlock:[function(t,e,o){"use strict";cc._RF.push(e,"e8c89kF4L5J7ZMMHjncSase","BombBlock");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},c=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c},s=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<o;e++)for(var r=arguments[e],c=0,s=r.length;c<s;c++,i++)n[i]=r[c];return n};Object.defineProperty(o,"__esModule",{value:!0});var l=t("../Utils/Animates"),a=t("../Utils/utils"),p=t("./SimpleBlock"),u=cc._decorator.ccclass,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isTouched=!1,e}return i(e,t),e.prototype.start=function(){this.parent=this.getComponent(p.default)},e.prototype.handleBlocks=function(t){var e=t.filter(function(t){return(null==t?void 0:t.type)<p.BlockTypes.BOMB}),o=this.parent,n=o.game,i=o.mapController;n.media.screams.playParallel(e.length),i.removeBlocks(s([this.parent],e)),n.levelController.fire(e.length)},e.prototype.onTouch=function(){if(!this.isTouched){this.isTouched=!0;var t=this.parent,e=t.game,o=t.mapController,n=t.type,i=t.column,c=t.row,s=o.bombRadius,u=o.mapHeight,h=o.mapWidth,d=o.mapNode,f=[];switch(n){case p.BlockTypes.BOMB:for(var y=i-s;y<=i+s;y++)for(var m=c-s;m<=c+s;m++)f.push(o.getBlock(y,m));l.default.play(e.media.mcExplosion,{x:this.node.x,y:this.node.y,target:d});break;case p.BlockTypes.BOMB_M:return l.default.play(e.media.megumin,r({target:d,y:0},a.selectAny([{x:0,scaleX:1,angle:30},{x:d.width,scaleX:-1,angle:-30}]))),l.default.play(e.media.explosion,{target:d,x:d.width/2,y:d.height/2}),void this.scheduleOnce(function(){var t;o.reset(),e.levelController.fire(u*h-1),null===(t=e.trembleScreenNode.getComponentInChildren(cc.Animation))||void 0===t||t.play()},e.animationDurability/2);case p.BlockTypes.RACKETS:f.push.apply(f,o.mapData[i]),l.default.play(e.media.lux,r({x:this.node.x,target:d},a.selectAny([{angle:90,y:d.height},{angle:-90}])));break;case p.BlockTypes.RACKETS_H:f.push.apply(f,o.mapData.map(function(t){return t[c]})),l.default.play(e.media.lux,r({y:this.node.y,target:d},a.selectAny([{x:d.width},{x:0,scaleX:-e.media.lux.scaleX}])))}this.handleBlocks(f)}},c([u],e)}(cc.Component);o.default=h,cc._RF.pop()},{"../Utils/Animates":"Animates","../Utils/utils":"utils","./SimpleBlock":"SimpleBlock"}],BoostersController:[function(t,e,o){"use strict";cc._RF.push(e,"621d6QeduNM1KD0DNrMyakN","BoostersController");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("./Booster"),s=cc._decorator,l=s.ccclass,a=s.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boostersNode=null,e.boosters=null,e.game=null,e.active=null,e}return i(e,t),e.prototype.deactivate=function(){this.active.deactivate(),this.active=null},e.prototype.onLoad=function(){this.boosters=this.boostersNode.getComponentsInChildren(c.default)},e.prototype.init=function(t){var e=this;this.game=t,this.boosters.forEach(function(t){return t.init(e)})},Object.defineProperty(e.prototype,"hasBoosters",{get:function(){return this.boosters.some(function(t){return t.count})},enumerable:!1,configurable:!0}),e.prototype.start=function(){},e.prototype.activate=function(t){var e;null===(e=this.active)||void 0===e||e.deactivate(),this.active=t},e.prototype.updateCount=function(t,e){var o=this.boosters.find(function(e){return e.type===t});o&&(o.count=e)},r([a(cc.Node)],e.prototype,"boostersNode",void 0),r([l],e)}(cc.Component);o.default=p,cc._RF.pop()},{"./Booster":"Booster"}],Booster:[function(t,e,o){"use strict";cc._RF.push(e,"3f1e6MnwKBO7KGP9X87qael","Booster");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.BoosterType=void 0;var c,s=t("../Blocks/SimpleBlock"),l=cc._decorator,a=l.ccclass,p=l.property;(function(t){t[t.NONE=0]="NONE",t[t.BOMB=1]="BOMB",t[t.TELEPORT=2]="TELEPORT"})(c=o.BoosterType||(o.BoosterType={}));var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=c.NONE,e.count=0,e.labelCount=null,e.pickedBlock=null,e}return i(e,t),e.prototype.init=function(t){this.boostersController=t},e.prototype.start=function(){var t=this;this.node.on(cc.Node.EventType.TOUCH_START,function(){t.onTouch()})},Object.defineProperty(e.prototype,"isActive",{get:function(){return this.boostersController.active===this},enumerable:!1,configurable:!0}),e.prototype.resetPickedBLock=function(){if(this.pickedBlock){var t=this.boostersController.game;this.pickedBlock.node.angle=0,this.pickedBlock=null,t.media.sounds.getSound("helicopter").stop()}},e.prototype.onTouch=function(){if(!(this.count<=0)){if(this.isActive)return this.resetPickedBLock(),void this.boostersController.deactivate();this.boostersController.activate(this);var t=this.boostersController.game;cc.tween(this.node).to((1-t.longAnimationMultiplier)*t.animationDurability,{scale:1.1}).start()}},e.prototype.use=function(t){var e=this.boostersController.game,o=e.levelController.mapController;switch(this.type){case c.BOMB:cc.tween(t.node).to(e.animationDurability*(1-e.longAnimationMultiplier),{scale:1}).to(e.animationDurability*e.longAnimationMultiplier,{scale:0}).call(function(){t.remove()}).start(),o.createBlock(t.column,t.row,s.BlockTypes.BOMB);break;case c.TELEPORT:if(this.pickedBlock===t)return void e.media.sounds.playSound("alert");if(!this.pickedBlock)return this.pickedBlock=t,void e.media.sounds.playSound("helicopter");o.swapBlocks(this.pickedBlock,t),e.media.sounds.playSound("airplane"),this.resetPickedBLock()}this.boostersController.deactivate(),this.count-=1},e.prototype.deactivate=function(){var t=this.boostersController.game;cc.tween(this.node).to((1-t.longAnimationMultiplier)*t.animationDurability,{scale:1}).start(),this.pickedBlock=null},e.prototype.update=function(t){this.labelCount.string=""+this.count,this.pickedBlock&&(this.pickedBlock.node.angle+=(this.count%2?1:-1)*this.boostersController.game.animationDurability*t*1e3)},r([p({type:cc.Enum(c)})],e.prototype,"type",void 0),r([p(cc.Integer)],e.prototype,"count",void 0),r([p(cc.Label)],e.prototype,"labelCount",void 0),r([a],e)}(cc.Component);o.default=u,cc._RF.pop()},{"../Blocks/SimpleBlock":"SimpleBlock"}],CustomFly:[function(t,e,o){"use strict";cc._RF.push(e,"22894nvFvxBho4QT/rgQh2G","CustomFly");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../Utils/utils"),s=cc._decorator.ccclass,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.gravity=9.8,e.angle=Math.PI/4,e.speed=100,e.time=0,e.isFalling=!1,e.duration=40,e}return i(e,t),e.prototype.start=function(){this.x=this.node.x,this.y=this.node.y,this.angle=c.selectBetween(0,Math.PI),this.speed=c.selectBetween(this.speed/2,this.speed)},e.prototype.fall=function(){this.isFalling=!0},e.prototype.update=function(t){this.isFalling&&(this.time+=t*this.duration,this.node.x=this.x+this.speed*this.time*Math.cos(this.angle),this.node.y=this.y+this.speed*this.time*Math.sin(this.angle)-.5*this.gravity*Math.pow(this.time,2))},r([s],e)}(cc.Component);o.default=l,cc._RF.pop()},{"../Utils/utils":"utils"}],Game:[function(t,e,o){"use strict";cc._RF.push(e,"51b61d0b9hGkbQvKsk/p0ku","Game");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../Level/LevelController"),s=t("../Media/Media"),l=cc._decorator,a=l.ccclass,p=l.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.animationDurability=.5,e.longAnimationMultiplier=.8,e.levelControllerNode=null,e.levelController=null,e.mediaNode=null,e.media=null,e.trembleScreenNode=null,e}return i(e,t),e.prototype.start=function(){this.levelController=this.levelControllerNode.getComponent(c.default),this.media=this.mediaNode.getComponent(s.default),this.levelController.init(this)},e.prototype.update=function(){},r([p(cc.Integer)],e.prototype,"animationDurability",void 0),r([p(cc.Integer)],e.prototype,"longAnimationMultiplier",void 0),r([p(cc.Node)],e.prototype,"levelControllerNode",void 0),r([p(cc.Node)],e.prototype,"mediaNode",void 0),r([p(cc.Node)],e.prototype,"trembleScreenNode",void 0),r([a],e)}(cc.Component);o.default=u,cc._RF.pop()},{"../Level/LevelController":"LevelController","../Media/Media":"Media"}],LevelController:[function(t,e,o){"use strict";cc._RF.push(e,"ef58aGz/05MBLwez7EoeZQh","LevelController");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../Boosters/Booster"),s=t("../Boosters/BoostersController"),l=t("../Map/MapController"),a=t("../Utils/Animates"),p=t("../Utils/utils"),u=cc._decorator,h=u.ccclass,d=u.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.victoryNode=null,e.defeatNode=null,e.scoresLabel=null,e.stepsLabel=null,e.mapNode=null,e.mapController=null,e.steps=0,e.stepsLimit=10,e.scores=0,e.scoresLimit=100,e.mapShakes=0,e.mapShakesLimit=3,e.minMapSize=3,e.maxMapSize=9,e.boostersNode=null,e.game=null,e}return i(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){var t=this;this.victoryNode.on(cc.Node.EventType.TOUCH_START,function(){return t.restart()}),this.defeatNode.on(cc.Node.EventType.TOUCH_START,function(){return t.restart()})},e.prototype.init=function(t){this.mapController=this.mapNode.getComponent(l.default),this.boostersController=this.boostersNode.getComponent(s.default),this.game=t,this.boostersController.init(t)},e.prototype.shake=function(){this.mapShakes+=1,this.mapShakes>this.mapShakesLimit&&!this.boostersController.hasBoosters&&this.defeat()},e.prototype.fire=function(t){this.scores+=t,this.steps+=1,a.default.play(this.stepsLabel.node),a.default.play(this.scoresLabel.node),this.scores>=this.scoresLimit?this.victory():this.steps>=this.stepsLimit&&this.defeat()},e.prototype.victory=function(){var t;this.victoryNode.active=!0,this.mapController.clear(),null===(t=this.victoryNode.getComponentInChildren(cc.Animation))||void 0===t||t.play()},e.prototype.defeat=function(){var t;this.defeatNode.active=!0,this.mapController.clear(),null===(t=this.defeatNode.getComponentInChildren(cc.Animation))||void 0===t||t.play()},e.prototype.restart=function(){this.victoryNode.active=!1,this.defeatNode.active=!1,this.steps=0,this.scores=0,this.mapShakes=0,this.generateLevel()},e.prototype.generateLevel=function(){var t=Math.round(p.selectBetween(this.minMapSize,this.maxMapSize)),e=Math.round(p.selectBetween(this.minMapSize,this.maxMapSize));this.mapController.mapHeight=t,this.mapController.mapWidth=e,this.scoresLimit=e*t*Math.round(p.selectBetween(2,5)),this.stepsLimit=Math.round(this.scoresLimit/Math.ceil(.75*Math.min(e,t))),this.boostersController.updateCount(c.BoosterType.BOMB,Math.round(Math.sqrt(e*t))),this.boostersController.updateCount(c.BoosterType.TELEPORT,Math.round(1.5*Math.sqrt(e*t))),this.mapController.init()},e.prototype.updateLabels=function(){this.stepsLabel.string=""+(this.stepsLimit-this.steps),this.scoresLabel.string=this.scores+"/"+this.scoresLimit},e.prototype.update=function(){this.updateLabels()},r([d(cc.Node)],e.prototype,"victoryNode",void 0),r([d(cc.Node)],e.prototype,"defeatNode",void 0),r([d(cc.Label)],e.prototype,"scoresLabel",void 0),r([d(cc.Label)],e.prototype,"stepsLabel",void 0),r([d(cc.Node)],e.prototype,"mapNode",void 0),r([d],e.prototype,"stepsLimit",void 0),r([d],e.prototype,"scoresLimit",void 0),r([d],e.prototype,"mapShakesLimit",void 0),r([d],e.prototype,"minMapSize",void 0),r([d],e.prototype,"maxMapSize",void 0),r([d(cc.Node)],e.prototype,"boostersNode",void 0),r([h],e)}(cc.Component);o.default=f,cc._RF.pop()},{"../Boosters/Booster":"Booster","../Boosters/BoostersController":"BoostersController","../Map/MapController":"MapController","../Utils/Animates":"Animates","../Utils/utils":"utils"}],MapController:[function(t,e,o){"use strict";cc._RF.push(e,"dd202pPAkhNLb3PDmDhpQ50","MapController");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../Blocks/SimpleBlock"),s=t("../Game/Game"),l=t("../Utils/utils"),a=cc._decorator,p=a.ccclass,u=a.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mapWidth=8,e.mapHeight=9,e.blockSize=80,e.blocksGap=5,e.minimalChainLength=2,e.bombSpawnChainLength=5,e.maxBombSpawnChainLength=10,e.bombRadius=3,e.colorBlocksNode=null,e.bombsBlocksNode=null,e.mapNode=null,e.mapBackgroundNode=null,e.gameNode=null,e.game=null,e.mapData=[],e.blockList=[],e.bombsList=[],e}return i(e,t),e.prototype.start=function(){this.game=this.gameNode.getComponent(s.default),this.blockList=this.colorBlocksNode.getComponentsInChildren(c.default),this.bombsList=this.bombsBlocksNode.getComponentsInChildren(c.default),this.init()},e.prototype.init=function(){var t=this,e=(this.mapWidth-1)*(this.blockSize+this.blocksGap),o=(this.mapHeight-1)*(this.blockSize+this.blocksGap);this.mapNode.width=e,this.mapNode.height=o,this.mapBackgroundNode.width=e+2*(this.blockSize+this.blocksGap),this.mapBackgroundNode.height=o+2*(this.blockSize+this.blocksGap),this.mapData=Array.from({length:this.mapWidth}).map(function(){return Array.from({length:t.mapHeight})}),this.fillMap()},e.prototype.fillMap=function(){var t=this;this.mapData.forEach(function(e,o){e.forEach(function(e,n){e||t.createBlock(o,n)})}),this.hasMoves||(this.reset(),this.game.levelController.shake())},e.prototype.createBlock=function(t,e,o){var n=this.getBlockByType(o)||l.selectAny(this.blockList),i=cc.instantiate(null==n?void 0:n.node);this.mapNode.addChild(i);var r=i.getComponent(c.default);switch(this.mapData[t][e]=r,r.type){case c.BlockTypes.BOMB_M:this.game.media.sounds.playSound("planted");break;case c.BlockTypes.BOMB:case c.BlockTypes.RACKETS:case c.BlockTypes.RACKETS_H:this.game.media.sounds.playSound("C4")}r.spawn(this,t,e)},e.prototype.reset=function(){this.clear(),this.fillMap()},e.prototype.clear=function(){var t=this;this.mapData.forEach(function(e){e.forEach(function(e){t.removeBlock(e)})})},Object.defineProperty(e.prototype,"hasMoves",{get:function(){var t=this;return this.mapData.some(function(e,o){return e.some(function(n,i){var r,s;return(null==n?void 0:n.type)>=c.BlockTypes.BOMB||(null==n?void 0:n.type)===(null===(r=e[i+1])||void 0===r?void 0:r.type)||(null==n?void 0:n.type)===(null===(s=t.mapData[o+1])||void 0===s?void 0:s[i].type)})})},enumerable:!1,configurable:!0}),e.prototype.getBlockByType=function(t){return this.bombsList.find(function(e){return e.type===t})||this.blockList.find(function(e){return e.type===t})},e.prototype.replaceBlock=function(t,e,o){var n;if(null===(n=this.mapData[t])||void 0===n?void 0:n[e]){if(this.mapData[t][e]=o,!o)return;o.column=t,o.row=e,o.move()}},e.prototype.swapBlocks=function(t,e){var o=e.column,n=e.row;this.replaceBlock(t.column,t.row,e),this.replaceBlock(o,n,t)},e.prototype.removeBlocks=function(t){var e=this;t.forEach(function(t){return e.removeBlock(t)}),this.fallMap()},e.prototype.fallMap=function(){var t=this;this.mapData=this.mapData.map(function(e,o){var n=Array.from({length:t.mapHeight});return e.filter(function(t){return t}).forEach(function(t,e){t.column=o,t.row=e,t.move(),n[e]=t}),n}),this.fillMap()},e.prototype.removeBlock=function(t){if(t){var e=t.column,o=t.row;this.mapData[e][o]=null,t.remove()}},e.prototype.getBlock=function(t,e){var o;return null===(o=this.mapData[t])||void 0===o?void 0:o[e]},r([u(cc.Integer)],e.prototype,"mapWidth",void 0),r([u(cc.Integer)],e.prototype,"mapHeight",void 0),r([u(cc.Integer)],e.prototype,"blockSize",void 0),r([u(cc.Integer)],e.prototype,"blocksGap",void 0),r([u(cc.Integer)],e.prototype,"minimalChainLength",void 0),r([u(cc.Integer)],e.prototype,"bombSpawnChainLength",void 0),r([u(cc.Integer)],e.prototype,"maxBombSpawnChainLength",void 0),r([u(cc.Integer)],e.prototype,"bombRadius",void 0),r([u(cc.Node)],e.prototype,"colorBlocksNode",void 0),r([u(cc.Node)],e.prototype,"bombsBlocksNode",void 0),r([u(cc.Node)],e.prototype,"mapNode",void 0),r([u(cc.Node)],e.prototype,"mapBackgroundNode",void 0),r([u(cc.Node)],e.prototype,"gameNode",void 0),r([p],e)}(cc.Component);o.default=h,cc._RF.pop()},{"../Blocks/SimpleBlock":"SimpleBlock","../Game/Game":"Game","../Utils/utils":"utils"}],Media:[function(t,e,o){"use strict";cc._RF.push(e,"a23c9cS7ItE/IliC56oU0t7","Media");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("./SoundSystem"),s=cc._decorator,l=s.ccclass,a=s.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lux=null,e.megumin=null,e.explosion=null,e.mcExplosion=null,e.screamsNode=null,e.soundsNode=null,e.mainThemeNode=null,e}return i(e,t),e.prototype.onLoad=function(){this.screams=this.screamsNode.getComponent(c.default),this.sounds=this.soundsNode.getComponent(c.default),this.mainTheme=this.mainThemeNode.getComponent(c.default)},e.prototype.start=function(){},r([a(cc.Node)],e.prototype,"lux",void 0),r([a(cc.Node)],e.prototype,"megumin",void 0),r([a(cc.Node)],e.prototype,"explosion",void 0),r([a(cc.Node)],e.prototype,"mcExplosion",void 0),r([a(cc.Node)],e.prototype,"screamsNode",void 0),r([a(cc.Node)],e.prototype,"soundsNode",void 0),r([a(cc.Node)],e.prototype,"mainThemeNode",void 0),r([l],e)}(cc.Component);o.default=p,cc._RF.pop()},{"./SoundSystem":"SoundSystem"}],SimpleBlock:[function(t,e,o){"use strict";cc._RF.push(e,"bcccaVEHqRIwargEqynWD8n","SimpleBlock");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c},c=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<o;e++)for(var r=arguments[e],c=0,s=r.length;c<s;c++,i++)n[i]=r[c];return n};Object.defineProperty(o,"__esModule",{value:!0}),o.SimpleBlockState=o.BombTypes=o.BlockTypes=void 0;var s,l,a=t("../Animation/CustomFly"),p=t("../Game/Game"),u=t("../Utils/Animates"),h=t("../Utils/utils"),d=t("./BombBlock"),f=cc._decorator,y=f.ccclass,m=f.property;(function(t){t[t.NONE=0]="NONE",t[t.RED=1]="RED",t[t.GREEN=2]="GREEN",t[t.BLUE=3]="BLUE",t[t.PURPLE=4]="PURPLE",t[t.YELLOW=5]="YELLOW",t[t.BOMB=6]="BOMB",t[t.BOMB_M=7]="BOMB_M",t[t.RACKETS=8]="RACKETS",t[t.RACKETS_H=9]="RACKETS_H"})(s=o.BlockTypes||(o.BlockTypes={})),o.BombTypes=[s.BOMB,s.BOMB_M,s.RACKETS,s.RACKETS_H],function(t){t.NONE="none",t.IDLE="idle",t.FALL="fall",t.SPAWN="spawn",t.TOUCHED="touched",t.REMOVED="removed"}(l=o.SimpleBlockState||(o.SimpleBlockState={}));var v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=s.NONE,e.gameNode=null,e.column=0,e.row=0,e.state=l.NONE,e.update=function(){},e}return i(e,t),e.prototype.spawn=function(t,e,o,n){var i=this;this.mapController=t,this.game=this.gameNode.getComponent(p.default);var r=t.blocksGap,c=t.blockSize,s=this.game,a=s.animationDurability,u=s.longAnimationMultiplier;return this.state=l.SPAWN,this.node.active=!0,this.column=e,this.row=o,this.node.width=c,this.node.height=c,this.node.x=(this.node.width+r)*e,this.node.y=(this.node.height+r)*o,this.node.scale=0,cc.tween(this.node).delay(a).to(a*u,{scale:1.1}).to(a*(1-u),{scale:1}).call(function(){i.state=l.IDLE,null==n||n()}).start(),this.node.on(cc.Node.EventType.TOUCH_START,function(){return i.onTouch()}),this},e.prototype.start=function(){},Object.defineProperty(e.prototype,"booster",{get:function(){return this.game.levelController.boostersController.active},enumerable:!1,configurable:!0}),e.prototype.onTouch=function(){if(this.state===l.IDLE)if(o.BombTypes.includes(this.type))this.getComponent(d.default).onTouch();else if(this.booster)this.booster.use(this);else{var t=this.fireTouch(),e=this.mapController,n=e.minimalChainLength,i=e.bombSpawnChainLength,r=e.maxBombSpawnChainLength;if(!(t.length<n)){var c=t[0],a=t.slice(1);if(this.mapController.removeBlock(c),t.length>=i){var p=t.length>=r?s.BOMB_M:h.selectAny([s.BOMB,s.RACKETS,s.RACKETS_H]);this.mapController.createBlock(this.column,this.row,p)}this.game.media.sounds.playSound("Weee"),this.mapController.removeBlocks(a),this.game.levelController.fire(t.length),t.forEach(function(t){return t&&(t.state=l.IDLE)})}}},e.prototype.fireTouch=function(){var t=this.column,e=this.row;return this.state=l.TOUCHED,c([this],this.touchSame(t-1,e),this.touchSame(t+1,e),this.touchSame(t,e-1),this.touchSame(t,e+1))},e.prototype.touchSame=function(t,e){var o=this.mapController.getBlock(t,e);return(null==o?void 0:o.type)===this.type&&o.state!==l.TOUCHED?c(o.fireTouch()):[]},e.prototype.remove=function(){var t,e=this;this.state=l.REMOVED,this.node.zIndex+=1,null===(t=this.getComponent(a.default))||void 0===t||t.fall(),u.default.play(this.node),this.scheduleOnce(function(){e.mapController.mapNode.removeChild(e.node)},this.game.animationDurability)},e.prototype.move=function(){var t=this,e=this.mapController,o=e.blocksGap,n=e.blockSize,i=this.game.animationDurability;this.node.zIndex+=1,cc.tween(this.node).to(i,{position:cc.v3((n+o)*this.column,(n+o)*this.row)}).call(function(){t.state=l.IDLE,t.node.zIndex-=1}).start()},r([m({type:cc.Enum(s)})],e.prototype,"type",void 0),r([m(cc.Node)],e.prototype,"gameNode",void 0),r([y],e)}(cc.Component);o.default=v,cc._RF.pop()},{"../Animation/CustomFly":"CustomFly","../Game/Game":"Game","../Utils/Animates":"Animates","../Utils/utils":"utils","./BombBlock":"BombBlock"}],SoundSystem:[function(t,e,o){"use strict";cc._RF.push(e,"7b692jcxIdJrZ12zPZzXu+U","SoundSystem");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../Utils/utils"),s=cc._decorator,l=s.ccclass,a=s.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.duration=1,e.onceLimit=1,e.volumes=null,e}return i(e,t),e.prototype.onLoad=function(){this.sounds=this.node.getComponentsInChildren(cc.AudioSource),this.volumes=new Map(this.sounds.map(function(t){return[t,t.volume]}))},e.prototype.start=function(){},e.prototype.getSound=function(t){return this.sounds.find(function(e){return e.node.name===t})},e.prototype.playSound=function(t){var e;null===(e=this.getSound(t))||void 0===e||e.play()},e.prototype.play=function(){var t=this,e=c.selectAny(this.sounds);e.volume=this.volumes.get(e),e.play(),cc.tween(e).to(this.duration,{volume:.1}).call(function(){return t.node.removeChild(e.node)}).start()},e.prototype.playParallel=function(t){this.sounds.sort(function(){return Math.random()>.5?1:-1}).slice(0,t).forEach(function(t){return t.play()})},e.prototype.playChain=function(t,e){var o=this.sounds.sort(function(){return Math.random()>.5?1:-1}).slice(0,t);this.schedule(function(){var t;null===(t=o.shift())||void 0===t||t.play()},e,o.length-1,0)},r([a],e.prototype,"duration",void 0),r([a],e.prototype,"onceLimit",void 0),r([l],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../Utils/utils":"utils"}],utils:[function(t,e,o){"use strict";cc._RF.push(e,"e8db2zfra9EqL9MWxq0R7E5","utils"),Object.defineProperty(o,"__esModule",{value:!0}),o.selectBetween=o.selectAny=void 0,o.selectAny=function(t){return t[Math.round(Math.random()*(t.length-1))]},o.selectBetween=function(t,e){return t+Math.random()*(e-t)},cc._RF.pop()},{}]},{},["CustomFly","BombBlock","SimpleBlock","Booster","BoostersController","Game","LevelController","MapController","Media","SoundSystem","Animates","utils"]);